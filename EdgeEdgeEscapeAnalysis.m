syms nj1 nj2 nk1 nk2 dp1 dp2 s1 s2 S Xcm Ycm theta vj1 vj2 vk1 vk2
% e=[0;-1];
% d=[Xcm;Ycm];
nj = [nj1;nj2];
nk = [nk1;nk2];
dp = [dp1;dp2];
R = [cos(theta) -sin(theta);sin(theta) cos(theta)];
J = [0 1; -1 0];
A = [-J*nj J*nk];
B = [J*nj J*nk];
vj = [vj1;vj2];
vk = [vk1;vk2];
dv = vj-vk;
sv = vj+vk;

dels = A\(R.'*dp+dv);
d = 0.5*(dp-R*(sv+B*dels));
diffd = diff(d(2),theta);

% d = 0.5*(dp-R*(sv+B*A\(R.'*dp+dv)));
% diffd = diff(d(2),theta);

% thetaSol = solve(diffd(2)==0,theta,'ReturnConditions',true); %to generate the polynomial
[Avector,ATerms] = coeffs(diffd,[cos(theta),sin(theta)]);
% a1 = Avector(1);
% a2 = Avector(2);
% a3 = Avector(3);
% a4 = Avector(4);
% a5 = Avector(5);

% matlabFunction(Avector,'file','EEheightAvector')
%% checking the S-values
delS = A\(R.'*dp+dv);
[S1vector,S1Terms] = coeffs(delS(1),[cos(theta),sin(theta)]);
[S2vector,S2Terms] = coeffs(delS(2),[cos(theta),sin(theta)]);
% matlabFunction(S1vector,S2vector,'file','EEheightSvectors')
%% checking the sign of the second derivative
diff2d = diff(diffd,theta);
[Cvector,CTerms] = coeffs(diff2d,[cos(theta),sin(theta)]);
matlabFunction(Cvector,'file','EEheightCvector')
%% generating the COM position from the theta solution
[D1vector,DTerms1] = coeffs(d(1),[cos(theta),sin(theta)]);
[D2vector,DTerms1] = coeffs(d(2),[cos(theta),sin(theta)]);
Dmatrix = [D1vector;D2vector];
% matlabFunction(Dmatrix,'file','EEheightDmatrix')

%%
syms a1 a2 a3 a4 a5
syms x
polynomial = a1 + a3 + 2*a2*x + 2*a5*x + a1*x^4 + 4*a4*x^2 + 2*a5*x^3 - a3*x^4 - 2*a2*x^3 - 2*a1*x^2;
polynomial = collect(polynomial,x);
[Bvector,BTerms] = coeffs(polynomial,x);
p1 = Bvector(1)
p2 = Bvector(2)
p3 = Bvector(3)
p4 = Bvector(4)
p5 = Bvector(5)
%%
% syms p1 p2 p3 p4 p5 %for testing of solutions
polynomial = p1*x^4+p2*x^3+p3*x^2+p4*x+p5;

p = (8*p1*p3-3*p2^2)/(8*p1^2);

q = (p2^3-4*p1*p2*p3+8*p1^2*p4)/(8*p1^3);

del0 = p3^2-3*p2*p4+12*p1*p5;

del1 = 2*p3^3-9*p2*p3*p4+27*p2^2*p5+27*p1*p4^2-72*p1*p3*p5;

Q = ((del1+sqrt(del1^2-4*del0^3))/2)^(1/3);

S = 0.5*sqrt(-2*p/3+1/(3*p1)*(Q+del0/Q));


x1 = -p2/(4*p1)-S+0.5*sqrt(-4*S^2-2*p+q/S);
x2 = -p2/(4*p1)-S-0.5*sqrt(-4*S^2-2*p+q/S);
x3 = -p2/(4*p1)+S+0.5*sqrt(-4*S^2-2*p-q/S);
x4 = -p2/(4*p1)+S-0.5*sqrt(-4*S^2-2*p-q/S);

theta1 = 2*atan2(x1,1);
theta2 = 2*atan2(x1,1);
theta3 = 2*atan2(x1,1);
theta4 = 2*atan2(x1,1);

y1 = subs(d(2),theta,theta1);
% y2 = subs(d(2),theta,theta2);
% y3 = subs(d(2),theta,theta3);
% y4 = subs(d(2),theta,theta4);
matlabFunction(x1,'file','EEheight1')
% subsol1 = (subs(polynomial,x,x4));
% %% Verifying the solutions
% errorsum = 0;
% for i=1:100
% coef1 = 10.^randn(1,5).*sign(randn(1,5));
% errorsum = errorsum+abs(double(subs(subsol1,[a1,a2,a3,a4,a5],2.^randn(1,5))));
% % double(subs(subsol1,[a,b,c,d,e],coef1))
% end
% disp(errorsum)

%%
nj = randn(2,1);%[1;1];
nj = nj/norm(nj);
nk = randn(2,1);%[-1;1];
nk = nk/norm(nk);
vj = [0;0];
vk = randn(2,1);%[1;-1];
S = linspace(0.2,0.8,1000);
y1 = zeros(size(S));
y2 = zeros(size(S));
y3 = zeros(size(S));
y4 = zeros(size(S));
dirdp = randn(2,1);%[1;0];
for i=1:length(S)
    dp = S(i)*dirdp;
    [y1(i),y2(i),y3(i),y4(i)] = EEheight(dp,nj,nk,vj,vk);
end
plot(S,y1,S,y2,S,y3,S,y4)












%%
% syms x
% equation = a1 + a3 + 2*a2*x + 2*a5*x + a1*x^4 + 4*a4*x^2 + 2*a5*x^3 - a3*x^4 - 2*a2*x^3 - 2*a1*x^2;
% [bvector2,Terms2]=coeffs(equation,x);
% 
% % x1 = (a2 - a5)/(2*(a1 - a3)) - 1/2*sqrt((a2 - a5)^2/(a1 - a3)^2 + (4*(a1 - 2*a4))/(3*(a1 - a3)) + (-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2 + sqrt((-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2)^2 - 4*(16*a1^2 - 16*a4*a1 + 12*a2^2 - 12*a3^2 + 16*a4^2 - 12*a5^2)^3))^(1/3)/(3*2^(1/3)*(a1 - a3)) + (4*2^(1/3)*(4*a1^2 - 4*a4*a1 + 3*a2^2 - 3*a3^2 + 4*a4^2 - 3*a5^2))/(3*(a1 - a3)*(-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2 + sqrt((-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2)^2 - 4*(16*a1^2 - 16*a4*a1 + 12*a2^2 - 12*a3^2 + 16*a4^2 - 12*a5^2)^3))^(1/3))) - 1/2*sqrt((2*(a2 - a5)^2)/(a1 - a3)^2 + (8*(a1 - 2*a4))/(3*(a1 - a3)) - (-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2 + sqrt((-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2)^2 - 4*(16*a1^2 - 16*a4*a1 + 12*a2^2 - 12*a3^2 + 16*a4^2 - 12*a5^2)^3))^(1/3)/(3*2^(1/3)*(a1 - a3)) - (4*2^(1/3)*(4*a1^2 - 4*a4*a1 + 3*a2^2 - 3*a3^2 + 4*a4^2 - 3*a5^2))/(3*(a1 - a3)*(-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2 + sqrt((-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2)^2 - 4*(16*a1^2 - 16*a4*a1 + 12*a2^2 - 12*a3^2 + 16*a4^2 - 12*a5^2)^3))^(1/3)) - ((8*(a2 - a5)^3)/(a1 - a3)^3 + (16*(a1 - 2*a4)*(a2 - a5))/(a1 - a3)^2 - (16*(a2 + a5))/(a1 - a3))/(4*sqrt((a2 - a5)^2/(a1 - a3)^2 + (4*(a1 - 2*a4))/(3*(a1 - a3)) + (-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2 + sqrt((-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2)^2 - 4*(16*a1^2 - 16*a4*a1 + 12*a2^2 - 12*a3^2 + 16*a4^2 - 12*a5^2)^3))^(1/3)/(3*2^(1/3)*(a1 - a3)) + (4*2^(1/3)*(4*a1^2 - 4*a4*a1 + 3*a2^2 - 3*a3^2 + 4*a4^2 - 3*a5^2))/(3*(a1 - a3)*(-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2 + sqrt((-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2)^2 - 4*(16*a1^2 - 16*a4*a1 + 12*a2^2 - 12*a3^2 + 16*a4^2 - 12*a5^2)^3))^(1/3)))));
% % 
% % x2 = (a2 - a5)/(2*(a1 - a3)) - 1/2*sqrt((a2 - a5)^2/(a1 - a3)^2 + (4*(a1 - 2*a4))/(3*(a1 - a3)) + (-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2 + sqrt((-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2)^2 - 4*(16*a1^2 - 16*a4*a1 + 12*a2^2 - 12*a3^2 + 16*a4^2 - 12*a5^2)^3))^(1/3)/(3*2^(1/3)*(a1 - a3)) + (4*2^(1/3)*(4*a1^2 - 4*a4*a1 + 3*a2^2 - 3*a3^2 + 4*a4^2 - 3*a5^2))/(3*(a1 - a3)*(-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2 + sqrt((-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2)^2 - 4*(16*a1^2 - 16*a4*a1 + 12*a2^2 - 12*a3^2 + 16*a4^2 - 12*a5^2)^3))^(1/3))) + 1/2*sqrt((2*(a2 - a5)^2)/(a1 - a3)^2 + (8*(a1 - 2*a4))/(3*(a1 - a3)) - (-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2 + sqrt((-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2)^2 - 4*(16*a1^2 - 16*a4*a1 + 12*a2^2 - 12*a3^2 + 16*a4^2 - 12*a5^2)^3))^(1/3)/(3*2^(1/3)*(a1 - a3)) - (4*2^(1/3)*(4*a1^2 - 4*a4*a1 + 3*a2^2 - 3*a3^2 + 4*a4^2 - 3*a5^2))/(3*(a1 - a3)*(-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2 + sqrt((-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2)^2 - 4*(16*a1^2 - 16*a4*a1 + 12*a2^2 - 12*a3^2 + 16*a4^2 - 12*a5^2)^3))^(1/3)) - ((8*(a2 - a5)^3)/(a1 - a3)^3 + (16*(a1 - 2*a4)*(a2 - a5))/(a1 - a3)^2 - (16*(a2 + a5))/(a1 - a3))/(4*sqrt((a2 - a5)^2/(a1 - a3)^2 + (4*(a1 - 2*a4))/(3*(a1 - a3)) + (-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2 + sqrt((-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2)^2 - 4*(16*a1^2 - 16*a4*a1 + 12*a2^2 - 12*a3^2 + 16*a4^2 - 12*a5^2)^3))^(1/3)/(3*2^(1/3)*(a1 - a3)) + (4*2^(1/3)*(4*a1^2 - 4*a4*a1 + 3*a2^2 - 3*a3^2 + 4*a4^2 - 3*a5^2))/(3*(a1 - a3)*(-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2 + sqrt((-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2)^2 - 4*(16*a1^2 - 16*a4*a1 + 12*a2^2 - 12*a3^2 + 16*a4^2 - 12*a5^2)^3))^(1/3)))));
% % 
% % x3 = (a2 - a5)/(2*(a1 - a3)) + 1/2*sqrt((a2 - a5)^2/(a1 - a3)^2 + (4*(a1 - 2*a4))/(3*(a1 - a3)) + (-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2 + sqrt((-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2)^2 - 4*(16*a1^2 - 16*a4*a1 + 12*a2^2 - 12*a3^2 + 16*a4^2 - 12*a5^2)^3))^(1/3)/(3*2^(1/3)*(a1 - a3)) + (4*2^(1/3)*(4*a1^2 - 4*a4*a1 + 3*a2^2 - 3*a3^2 + 4*a4^2 - 3*a5^2))/(3*(a1 - a3)*(-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2 + sqrt((-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2)^2 - 4*(16*a1^2 - 16*a4*a1 + 12*a2^2 - 12*a3^2 + 16*a4^2 - 12*a5^2)^3))^(1/3))) - 1/2*sqrt((2*(a2 - a5)^2)/(a1 - a3)^2 + (8*(a1 - 2*a4))/(3*(a1 - a3)) - (-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2 + sqrt((-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2)^2 - 4*(16*a1^2 - 16*a4*a1 + 12*a2^2 - 12*a3^2 + 16*a4^2 - 12*a5^2)^3))^(1/3)/(3*2^(1/3)*(a1 - a3)) - (4*2^(1/3)*(4*a1^2 - 4*a4*a1 + 3*a2^2 - 3*a3^2 + 4*a4^2 - 3*a5^2))/(3*(a1 - a3)*(-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2 + sqrt((-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2)^2 - 4*(16*a1^2 - 16*a4*a1 + 12*a2^2 - 12*a3^2 + 16*a4^2 - 12*a5^2)^3))^(1/3)) + ((8*(a2 - a5)^3)/(a1 - a3)^3 + (16*(a1 - 2*a4)*(a2 - a5))/(a1 - a3)^2 - (16*(a2 + a5))/(a1 - a3))/(4*sqrt((a2 - a5)^2/(a1 - a3)^2 + (4*(a1 - 2*a4))/(3*(a1 - a3)) + (-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2 + sqrt((-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2)^2 - 4*(16*a1^2 - 16*a4*a1 + 12*a2^2 - 12*a3^2 + 16*a4^2 - 12*a5^2)^3))^(1/3)/(3*2^(1/3)*(a1 - a3)) + (4*2^(1/3)*(4*a1^2 - 4*a4*a1 + 3*a2^2 - 3*a3^2 + 4*a4^2 - 3*a5^2))/(3*(a1 - a3)*(-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2 + sqrt((-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2)^2 - 4*(16*a1^2 - 16*a4*a1 + 12*a2^2 - 12*a3^2 + 16*a4^2 - 12*a5^2)^3))^(1/3)))));
% % 
% % x4 = (a2 - a5)/(2*(a1 - a3)) + 1/2*sqrt((a2 - a5)^2/(a1 - a3)^2 + (4*(a1 - 2*a4))/(3*(a1 - a3)) + (-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2 + sqrt((-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2)^2 - 4*(16*a1^2 - 16*a4*a1 + 12*a2^2 - 12*a3^2 + 16*a4^2 - 12*a5^2)^3))^(1/3)/(3*2^(1/3)*(a1 - a3)) + (4*2^(1/3)*(4*a1^2 - 4*a4*a1 + 3*a2^2 - 3*a3^2 + 4*a4^2 - 3*a5^2))/(3*(a1 - a3)*(-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2 + sqrt((-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2)^2 - 4*(16*a1^2 - 16*a4*a1 + 12*a2^2 - 12*a3^2 + 16*a4^2 - 12*a5^2)^3))^(1/3))) + 1/2*sqrt((2*(a2 - a5)^2)/(a1 - a3)^2 + (8*(a1 - 2*a4))/(3*(a1 - a3)) - (-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2 + sqrt((-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2)^2 - 4*(16*a1^2 - 16*a4*a1 + 12*a2^2 - 12*a3^2 + 16*a4^2 - 12*a5^2)^3))^(1/3)/(3*2^(1/3)*(a1 - a3)) - (4*2^(1/3)*(4*a1^2 - 4*a4*a1 + 3*a2^2 - 3*a3^2 + 4*a4^2 - 3*a5^2))/(3*(a1 - a3)*(-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2 + sqrt((-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2)^2 - 4*(16*a1^2 - 16*a4*a1 + 12*a2^2 - 12*a3^2 + 16*a4^2 - 12*a5^2)^3))^(1/3)) + ((8*(a2 - a5)^3)/(a1 - a3)^3 + (16*(a1 - 2*a4)*(a2 - a5))/(a1 - a3)^2 - (16*(a2 + a5))/(a1 - a3))/(4*sqrt((a2 - a5)^2/(a1 - a3)^2 + (4*(a1 - 2*a4))/(3*(a1 - a3)) + (-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2 + sqrt((-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2)^2 - 4*(16*a1^2 - 16*a4*a1 + 12*a2^2 - 12*a3^2 + 16*a4^2 - 12*a5^2)^3))^(1/3)/(3*2^(1/3)*(a1 - a3)) + (4*2^(1/3)*(4*a1^2 - 4*a4*a1 + 3*a2^2 - 3*a3^2 + 4*a4^2 - 3*a5^2))/(3*(a1 - a3)*(-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2 + sqrt((-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2)^2 - 4*(16*a1^2 - 16*a4*a1 + 12*a2^2 - 12*a3^2 + 16*a4^2 - 12*a5^2)^3))^(1/3)))));
% %%
% equation1 = a1 + a3 + 2*a2*x1 + 2*a5*x1 + a1*x1^4 + 4*a4*x1^2 + 2*a5*x1^3 - a3*x1^4 - 2*a2*x1^3 - 2*a1*x1^2;
% double(subs(x1,[a1,a2,a3,a4,a5],[0 0 1 0 0]))
% double(subs(equation1,[a1,a2,a3,a4,a5],[0 0 1 0 0]))
% 
% %%
% x1s = '(a2 - a5)/(2*(a1 - a3)) - 1/2*sqrt((a2 - a5)^2/(a1 - a3)^2 + (4*(a1 - 2*a4))/(3*(a1 - a3)) + (-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2 + sqrt((-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2)^2 - 4*(16*a1^2 - 16*a4*a1 + 12*a2^2 - 12*a3^2 + 16*a4^2 - 12*a5^2)^3))^(1/3)/(3*2^(1/3)*(a1 - a3)) + (4*2^(1/3)*(4*a1^2 - 4*a4*a1 + 3*a2^2 - 3*a3^2 + 4*a4^2 - 3*a5^2))/(3*(a1 - a3)*(-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2 + sqrt((-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2)^2 - 4*(16*a1^2 - 16*a4*a1 + 12*a2^2 - 12*a3^2 + 16*a4^2 - 12*a5^2)^3))^(1/3))) - 1/2*sqrt((2*(a2 - a5)^2)/(a1 - a3)^2 + (8*(a1 - 2*a4))/(3*(a1 - a3)) - (-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2 + sqrt((-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2)^2 - 4*(16*a1^2 - 16*a4*a1 + 12*a2^2 - 12*a3^2 + 16*a4^2 - 12*a5^2)^3))^(1/3)/(3*2^(1/3)*(a1 - a3)) - (4*2^(1/3)*(4*a1^2 - 4*a4*a1 + 3*a2^2 - 3*a3^2 + 4*a4^2 - 3*a5^2))/(3*(a1 - a3)*(-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2 + sqrt((-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2)^2 - 4*(16*a1^2 - 16*a4*a1 + 12*a2^2 - 12*a3^2 + 16*a4^2 - 12*a5^2)^3))^(1/3)) - ((8*(a2 - a5)^3)/(a1 - a3)^3 + (16*(a1 - 2*a4)*(a2 - a5))/(a1 - a3)^2 - (16*(a2 + a5))/(a1 - a3))/(4*sqrt((a2 - a5)^2/(a1 - a3)^2 + (4*(a1 - 2*a4))/(3*(a1 - a3)) + (-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2 + sqrt((-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2)^2 - 4*(16*a1^2 - 16*a4*a1 + 12*a2^2 - 12*a3^2 + 16*a4^2 - 12*a5^2)^3))^(1/3)/(3*2^(1/3)*(a1 - a3)) + (4*2^(1/3)*(4*a1^2 - 4*a4*a1 + 3*a2^2 - 3*a3^2 + 4*a4^2 - 3*a5^2))/(3*(a1 - a3)*(-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2 + sqrt((-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2)^2 - 4*(16*a1^2 - 16*a4*a1 + 12*a2^2 - 12*a3^2 + 16*a4^2 - 12*a5^2)^3))^(1/3)))))';
% x2s = '(a2 - a5)/(2*(a1 - a3)) - 1/2*sqrt((a2 - a5)^2/(a1 - a3)^2 + (4*(a1 - 2*a4))/(3*(a1 - a3)) + (-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2 + sqrt((-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2)^2 - 4*(16*a1^2 - 16*a4*a1 + 12*a2^2 - 12*a3^2 + 16*a4^2 - 12*a5^2)^3))^(1/3)/(3*2^(1/3)*(a1 - a3)) + (4*2^(1/3)*(4*a1^2 - 4*a4*a1 + 3*a2^2 - 3*a3^2 + 4*a4^2 - 3*a5^2))/(3*(a1 - a3)*(-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2 + sqrt((-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2)^2 - 4*(16*a1^2 - 16*a4*a1 + 12*a2^2 - 12*a3^2 + 16*a4^2 - 12*a5^2)^3))^(1/3))) + 1/2*sqrt((2*(a2 - a5)^2)/(a1 - a3)^2 + (8*(a1 - 2*a4))/(3*(a1 - a3)) - (-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2 + sqrt((-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2)^2 - 4*(16*a1^2 - 16*a4*a1 + 12*a2^2 - 12*a3^2 + 16*a4^2 - 12*a5^2)^3))^(1/3)/(3*2^(1/3)*(a1 - a3)) - (4*2^(1/3)*(4*a1^2 - 4*a4*a1 + 3*a2^2 - 3*a3^2 + 4*a4^2 - 3*a5^2))/(3*(a1 - a3)*(-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2 + sqrt((-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2)^2 - 4*(16*a1^2 - 16*a4*a1 + 12*a2^2 - 12*a3^2 + 16*a4^2 - 12*a5^2)^3))^(1/3)) - ((8*(a2 - a5)^3)/(a1 - a3)^3 + (16*(a1 - 2*a4)*(a2 - a5))/(a1 - a3)^2 - (16*(a2 + a5))/(a1 - a3))/(4*sqrt((a2 - a5)^2/(a1 - a3)^2 + (4*(a1 - 2*a4))/(3*(a1 - a3)) + (-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2 + sqrt((-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2)^2 - 4*(16*a1^2 - 16*a4*a1 + 12*a2^2 - 12*a3^2 + 16*a4^2 - 12*a5^2)^3))^(1/3)/(3*2^(1/3)*(a1 - a3)) + (4*2^(1/3)*(4*a1^2 - 4*a4*a1 + 3*a2^2 - 3*a3^2 + 4*a4^2 - 3*a5^2))/(3*(a1 - a3)*(-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2 + sqrt((-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2)^2 - 4*(16*a1^2 - 16*a4*a1 + 12*a2^2 - 12*a3^2 + 16*a4^2 - 12*a5^2)^3))^(1/3)))))';
% x3s = '(a2 - a5)/(2*(a1 - a3)) + 1/2*sqrt((a2 - a5)^2/(a1 - a3)^2 + (4*(a1 - 2*a4))/(3*(a1 - a3)) + (-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2 + sqrt((-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2)^2 - 4*(16*a1^2 - 16*a4*a1 + 12*a2^2 - 12*a3^2 + 16*a4^2 - 12*a5^2)^3))^(1/3)/(3*2^(1/3)*(a1 - a3)) + (4*2^(1/3)*(4*a1^2 - 4*a4*a1 + 3*a2^2 - 3*a3^2 + 4*a4^2 - 3*a5^2))/(3*(a1 - a3)*(-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2 + sqrt((-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2)^2 - 4*(16*a1^2 - 16*a4*a1 + 12*a2^2 - 12*a3^2 + 16*a4^2 - 12*a5^2)^3))^(1/3))) - 1/2*sqrt((2*(a2 - a5)^2)/(a1 - a3)^2 + (8*(a1 - 2*a4))/(3*(a1 - a3)) - (-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2 + sqrt((-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2)^2 - 4*(16*a1^2 - 16*a4*a1 + 12*a2^2 - 12*a3^2 + 16*a4^2 - 12*a5^2)^3))^(1/3)/(3*2^(1/3)*(a1 - a3)) - (4*2^(1/3)*(4*a1^2 - 4*a4*a1 + 3*a2^2 - 3*a3^2 + 4*a4^2 - 3*a5^2))/(3*(a1 - a3)*(-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2 + sqrt((-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2)^2 - 4*(16*a1^2 - 16*a4*a1 + 12*a2^2 - 12*a3^2 + 16*a4^2 - 12*a5^2)^3))^(1/3)) + ((8*(a2 - a5)^3)/(a1 - a3)^3 + (16*(a1 - 2*a4)*(a2 - a5))/(a1 - a3)^2 - (16*(a2 + a5))/(a1 - a3))/(4*sqrt((a2 - a5)^2/(a1 - a3)^2 + (4*(a1 - 2*a4))/(3*(a1 - a3)) + (-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2 + sqrt((-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2)^2 - 4*(16*a1^2 - 16*a4*a1 + 12*a2^2 - 12*a3^2 + 16*a4^2 - 12*a5^2)^3))^(1/3)/(3*2^(1/3)*(a1 - a3)) + (4*2^(1/3)*(4*a1^2 - 4*a4*a1 + 3*a2^2 - 3*a3^2 + 4*a4^2 - 3*a5^2))/(3*(a1 - a3)*(-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2 + sqrt((-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2)^2 - 4*(16*a1^2 - 16*a4*a1 + 12*a2^2 - 12*a3^2 + 16*a4^2 - 12*a5^2)^3))^(1/3)))))';
% x4s = '(a2 - a5)/(2*(a1 - a3)) + 1/2*sqrt((a2 - a5)^2/(a1 - a3)^2 + (4*(a1 - 2*a4))/(3*(a1 - a3)) + (-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2 + sqrt((-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2)^2 - 4*(16*a1^2 - 16*a4*a1 + 12*a2^2 - 12*a3^2 + 16*a4^2 - 12*a5^2)^3))^(1/3)/(3*2^(1/3)*(a1 - a3)) + (4*2^(1/3)*(4*a1^2 - 4*a4*a1 + 3*a2^2 - 3*a3^2 + 4*a4^2 - 3*a5^2))/(3*(a1 - a3)*(-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2 + sqrt((-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2)^2 - 4*(16*a1^2 - 16*a4*a1 + 12*a2^2 - 12*a3^2 + 16*a4^2 - 12*a5^2)^3))^(1/3))) + 1/2*sqrt((2*(a2 - a5)^2)/(a1 - a3)^2 + (8*(a1 - 2*a4))/(3*(a1 - a3)) - (-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2 + sqrt((-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2)^2 - 4*(16*a1^2 - 16*a4*a1 + 12*a2^2 - 12*a3^2 + 16*a4^2 - 12*a5^2)^3))^(1/3)/(3*2^(1/3)*(a1 - a3)) - (4*2^(1/3)*(4*a1^2 - 4*a4*a1 + 3*a2^2 - 3*a3^2 + 4*a4^2 - 3*a5^2))/(3*(a1 - a3)*(-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2 + sqrt((-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2)^2 - 4*(16*a1^2 - 16*a4*a1 + 12*a2^2 - 12*a3^2 + 16*a4^2 - 12*a5^2)^3))^(1/3)) + ((8*(a2 - a5)^3)/(a1 - a3)^3 + (16*(a1 - 2*a4)*(a2 - a5))/(a1 - a3)^2 - (16*(a2 + a5))/(a1 - a3))/(4*sqrt((a2 - a5)^2/(a1 - a3)^2 + (4*(a1 - 2*a4))/(3*(a1 - a3)) + (-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2 + sqrt((-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2)^2 - 4*(16*a1^2 - 16*a4*a1 + 12*a2^2 - 12*a3^2 + 16*a4^2 - 12*a5^2)^3))^(1/3)/(3*2^(1/3)*(a1 - a3)) + (4*2^(1/3)*(4*a1^2 - 4*a4*a1 + 3*a2^2 - 3*a3^2 + 4*a4^2 - 3*a5^2))/(3*(a1 - a3)*(-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2 + sqrt((-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2)^2 - 4*(16*a1^2 - 16*a4*a1 + 12*a2^2 - 12*a3^2 + 16*a4^2 - 12*a5^2)^3))^(1/3)))))';
% 
% comp1 = find(x1s~=x2s)
% x1s(comp1-10:comp1+10)
% x2s(comp1-10:comp1+10)
% 
% comp2 = find(x1s~=x3s)
% for i=1:length(comp2)
% x1s(comp2(i)-10:comp2(i)+10)
% x3s(comp2(i)-10:comp2(i)+10)
% end
% %%
% a1 = 0;
% a2 = 0;
% a3 = 1;
% a4 = 0;
% a5 = 0;
% x1 = (a2 - a5)/(2*(a1 - a3)) - 1/2*sqrt((a2 - a5)^2/(a1 - a3)^2 + (4*(a1 - 2*a4))/(3*(a1 - a3)) + (-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2 + sqrt((-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2)^2 - 4*(16*a1^2 - 16*a4*a1 + 12*a2^2 - 12*a3^2 + 16*a4^2 - 12*a5^2)^3))^(1/3)/(3*2^(1/3)*(a1 - a3)) + (4*2^(1/3)*(4*a1^2 - 4*a4*a1 + 3*a2^2 - 3*a3^2 + 4*a4^2 - 3*a5^2))/(3*(a1 - a3)*(-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2 + sqrt((-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2)^2 - 4*(16*a1^2 - 16*a4*a1 + 12*a2^2 - 12*a3^2 + 16*a4^2 - 12*a5^2)^3))^(1/3))) - 1/2*sqrt((2*(a2 - a5)^2)/(a1 - a3)^2 + (8*(a1 - 2*a4))/(3*(a1 - a3)) - (-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2 + sqrt((-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2)^2 - 4*(16*a1^2 - 16*a4*a1 + 12*a2^2 - 12*a3^2 + 16*a4^2 - 12*a5^2)^3))^(1/3)/(3*2^(1/3)*(a1 - a3)) - (4*2^(1/3)*(4*a1^2 - 4*a4*a1 + 3*a2^2 - 3*a3^2 + 4*a4^2 - 3*a5^2))/(3*(a1 - a3)*(-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2 + sqrt((-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2)^2 - 4*(16*a1^2 - 16*a4*a1 + 12*a2^2 - 12*a3^2 + 16*a4^2 - 12*a5^2)^3))^(1/3)) - ((8*(a2 - a5)^3)/(a1 - a3)^3 + (16*(a1 - 2*a4)*(a2 - a5))/(a1 - a3)^2 - (16*(a2 + a5))/(a1 - a3))/(4*sqrt((a2 - a5)^2/(a1 - a3)^2 + (4*(a1 - 2*a4))/(3*(a1 - a3)) + (-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108*(a1 + a3)*(a2 - a5)^2 + 108*(a1 - a3)*(a2 + a5)^2 + sqrt((-16*(a1 - 2*a4)^3 + 144*(a1 - a3)*(a1 + a3)*(a1 - 2*a4) - 72*(a2 - a5)*(a2 + a5)*(a1 - 2*a4) + 108 *(a1 + a3) *(a2 - a5)^2 + 108 *(a1 - a3) *(a2 + a5)^2)^2 - 4 *(16 *a1^2 - 16 *a4 *a1 + 12 *a2^2 - 12 *a3^2 + 16 *a4^2 - 12 *a5^2)^3))^(1/3)/(3 *2^(1/3) *(a1 - a3)) + (4 *2^(1/3) *(4 *a1^2 - 4 *a4 *a1 + 3 *a2^2 - 3 *a3^2 + 4 *a4^2 - 3 *a5^2))/(3 *(a1 - a3) *(-16 *(a1 - 2* a4)^3 + 144 *(a1 - a3) *(a1 + a3) *(a1 - 2 *a4) - 72 *(a2 - a5) *(a2 + a5) *(a1 - 2 *a4) + 108 *(a1 + a3) *(a2 - a5)^2 + 108 *(a1 - a3) *(a2 + a5)^2 + sqrt((-16 *(a1 - 2 *a4)^3 + 144 *(a1 - a3) *(a1 + a3) *(a1 - 2 *a4) - 72 *(a2 - a5) *(a2 + a5) *(a1 - 2 *a4) + 108 *(a1 + a3) *(a2 - a5)^2 + 108 *(a1 - a3) *(a2 + a5)^2)^2 - 4 *(16 *a1^2 - 16 *a4 *a1 + 12 *a2^2 - 12 *a3^2 + 16 *a4^2 - 12 *a5^2)^3))^(1/3)))));
% double(x1)
% equation1 = a1 + a3 + 2*a2*x1 + 2*a5*x1 + a1*x1^4 + 4*a4*x1^2 + 2*a5*x1^3 - a3*x1^4 - 2*a2*x1^3 - 2*a1*x1^2
% 
% %%
% b = [0 0 0 0 1];
% b0 = b(1);
% b1 = b(2);
% b2 = b(3);
% b3 = b(4);
% b4 = b(5);
% x = -1/2*sqrt((sqrt((-72*b0*b2*b4 + 27*b0*b3^2 + 27*b1^2*b4 - 9*b1*b2*b3 + 2*b2^3)^2 - 4*(12*b0*b4 - 3*b1*b3 + b2^2)^3) - 72*b0*b2*b4 + 27*b0*b3^2 + 27*b1^2*b4 - 9*b1*b2*b3 + 2*b2^3)^(1/3)/(3*2^(1/3)*b4) + (2^(1/3)*(12*b0*b4 - 3*b1*b3 + b2^2))/(3*b4*(sqrt((-72*b0*b2*b4 + 27*b0*b3^2 + 27*b1^2*b4 - 9*b1*b2*b3 + 2*b2^3)^2 - 4*(12*b0*b4 - 3*b1*b3 + b2^2)^3) - 72*b0*b2*b4 + 27*b0*b3^2 + 27*b1^2*b4 - 9*b1*b2*b3 + 2*b2^3)^(1/3)) - (2*b2)/(3*b4) + b3^2/(4*b4^2)) - 1/2*sqrt(-(sqrt((-72*b0*b2*b4 + 27*b0*b3^2 + 27*b1^2*b4 - 9*b1*b2*b3 + 2*b2^3)^2 - 4*(12*b0*b4 - 3*b1*b3 + b2^2)^3) - 72*b0*b2*b4 + 27*b0*b3^2 + 27*b1^2*b4 - 9*b1*b2*b3 + 2*b2^3)^(1/3)/(3*2^(1/3)*b4) - (2^(1/3)*(12*b0*b4 - 3*b1*b3 + b2^2))/(3*b4*(sqrt((-72*b0*b2*b4 + 27*b0*b3^2 + 27*b1^2*b4 - 9*b1*b2*b3 + 2*b2^3)^2 - 4*(12*b0*b4 - 3*b1*b3 + b2^2)^3) - 72*b0*b2*b4 + 27*b0*b3^2 + 27*b1^2*b4 - 9*b1*b2*b3 + 2*b2^3)^(1/3)) - (-(8*b1)/b4 + (4*b2*b3)/b4^2 - b3^3/b4^3)/(4*sqrt((sqrt((-72*b0*b2*b4 + 27*b0*b3^2 + 27*b1^2*b4 - 9*b1*b2*b3 + 2*b2^3)^2 - 4*(12*b0*b4 - 3*b1*b3 + b2^2)^3) - 72*b0*b2*b4 + 27*b0*b3^2 + 27*b1^2*b4 - 9*b1*b2*b3 + 2*b2^3)^(1/3)/(3*2^(1/3)*b4) + (2^(1/3)*(12*b0*b4 - 3*b1*b3 + b2^2))/(3*b4*(sqrt((-72*b0*b2*b4 + 27*b0*b3^2 + 27*b1^2*b4 - 9*b1*b2*b3 + 2*b2^3)^2 - 4*(12*b0*b4 - 3*b1*b3 + b2^2)^3) - 72*b0*b2*b4 + 27*b0*b3^2 + 27*b1^2*b4 - 9*b1*b2*b3 + 2*b2^3)^(1/3)) - (2*b2)/(3*b4) + b3^2/(4*b4^2))) - (4*b2)/(3*b4) + b3^2/(2*b4^2)) - b3/(4*b4)
% equation2 = b4*x^4 + b3*x^3 + b2*x^2 + b1*x + b0
% sol = solve(equation,x,'ReturnConditions',true,'real',true);
% sol.x
% sol.parameters
% sol.conditions

% subs(d(2),theta,thetaSol(1))
% subs(d(2),theta,thetaSol(2))
% simcross1 = cross([dp;0],[nk;0]);
% simcross2 = cross([d;0],[R.'*e;0]);
% 
% G=[nj nk R.'*e;0 simcross1(3) simcross2(3)];
% dG = det(G);
% [Avector,Terms]=coeffs(dG,[cos(theta),sin(theta)])
% 
% solve(dG==0,theta)
